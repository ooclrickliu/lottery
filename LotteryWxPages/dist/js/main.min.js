function GetQueryString(a){var e=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(e);return null!=t?unescape(t[2]):null}!function(){function a(a,e){return(/string|function/.test(typeof e)?r:n)(a,e)}function e(a,t){return"string"!=typeof a&&(t=typeof a,"number"===t?a+="":a="function"===t?e(a.call(a)):""),a}function t(a){return u[a]}function l(a){return e(a).replace(/&(?![\w#]+;)|[<>"']/g,t)}function i(a,e){if(v(a))for(var t=0,l=a.length;l>t;t++)e.call(a,a[t],t,a);else for(t in a)e.call(a,a[t],t)}function s(a,e){var t=/(\/)[^\/]+\1\.\.\1/,l=("./"+a).replace(/[^\/]+$/,""),i=l+e;for(i=i.replace(/\/\.\//g,"/");i.match(t);)i=i.replace(t,"/");return i}function n(e,t){var l=a.get(e)||o({filename:e,name:"Render Error",message:"Template not found"});return t?l(t):l}function r(a,e){if("string"==typeof e){var t=e;e=function(){return new d(t)}}var l=c[a]=function(t){try{return new e(t,a)+""}catch(l){return o(l)()}};return l.prototype=e.prototype=p,l.toString=function(){return e+""},l}function o(a){var e="{Template Error}",t=a.stack||"";if(t)t=t.split("\n").slice(0,2).join("\n");else for(var l in a)t+="<"+l+">\n"+a[l]+"\n\n";return function(){return"object"==typeof console&&console.error(e+"\n\n"+t),e}}var c=a.cache={},d=this.String,u={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},v=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},p=a.utils={$helpers:{},$include:function(a,e,t){return a=s(t,a),n(a,e)},$string:e,$escape:l,$each:i},b=a.helpers=p.$helpers;a.get=function(a){return c[a.replace(/^\.\//,"")]},a.helper=function(a,e){b[a]=e},"function"==typeof define?define(function(){return a}):"undefined"!=typeof exports?module.exports=a:this.template=a,a("ssqBuy",'<div style="display: flex;border-bottom: 1px solid #cccccc"> <div class="col-xs-6" style="padding: 10px;"> <a href="javascript:;" class="weui_btn weui_btn_default" id="selectBall"><span class="icon">+</span> <span>自选号码</span></a> </div> <div class="col-xs-6" style="padding: 10px;"> <a href="javascript:;" class="weui_btn weui_btn_default" id="randomFive"><span class="icon">+</span> <span>机选五注</span></a> </div> </div> <div class="content" style="margin-bottom: 160px;"> <div class="ball_list" id="ball_list"> </div> </div> <div class="footer"> <div style="border-bottom: 1px solid #cccccc"> <div class="col-xs-6"> <div class="spinner" style="border-right: 1px solid #dddddd;"> <span class="text-light">追</span> <a class="button" id="periodMinus">-</a> <input type="number" id="period" class="text" value="1"/> <a class="button" style="padding: 3px 8px;" id="periodAdd">+</a> <span class="text-light">期</span> </div> </div> <div class="col-xs-6"> <div class="spinner" > <span class="text-light">投</span> <a class="button" id="multipleMinus">-</a> <input type="number" id="multiple" class="text" value="1"/> <a class="button" style="padding: 3px 8px;" id="multipleAdd">+</a> <span class="text-light">倍</span> </div> </div> <div style="clear:both;height:0px;"></div> </div> <div class="content"> <div style="padding: 5px 0;"> <a href="javascript:;" id="submitDoubleBallSelect" class="weui_btn weui_btn_warn">立即付款 <span id="totalFee">0</span>&nbsp;元</a> </div> <div class="text-center text-light"> <input type="checkbox" value="" id="confirmProto" checked/> <label for="confirmProto" style="font-size: 14px;"> 我已阅读并同意《<a href="#" class="text-light text-underline">服务协议</a>》和《<a href="#" class="text-light text-underline">免密协议</a>》 </label> </div> </div> </div>'),a("ssqBuyList",function(a){"use strict";var e=this,t=(e.$helpers,e.$each),l=a.list,i=(a.item,a.i,e.$escape),s=(a.red,a.j,"");return t(l,function(a,e){s+=' <div class="ball_list_item" data-index="',s+=i(e),s+='"> ',t(a.red,function(a){s+=' <p class="text-red">',s+=i(a),s+="</p> "}),s+=" ",t(a.blue,function(a){s+=' <p class="text-info">',s+=i(a),s+="</p> "}),s+=" </div> "}),s+=" ",new d(s)}),a("ssqSelect",function(a){"use strict";var e=this,t=(e.$helpers,e.$escape),l=a.lottery,i="";return i+='<div class="notice"> <p><span>',i+=t(l.period),i+="</span>期 ",i+=t(l.openTime),i+=" 开奖 奖池 ",i+=t(l.totalMoney),i+='</p> </div> <div class="content" style="margin-bottom: 96px;"> <div class="ball_row"> <a href="javascript:void(0);" class="ball ball_red">01</a> <a href="javascript:void(0);" class="ball ball_red">02</a> <a href="javascript:void(0);" class="ball ball_red">03</a> <a href="javascript:void(0);" class="ball ball_red">04</a> <a href="javascript:void(0);" class="ball ball_red">05</a> <a href="javascript:void(0);" class="ball ball_red">06</a> <a href="javascript:void(0);" class="ball ball_red">07</a> <a href="javascript:void(0);" class="ball ball_red">08</a> <a href="javascript:void(0);" class="ball ball_red">09</a> <a href="javascript:void(0);" class="ball ball_red">10</a> <a href="javascript:void(0);" class="ball ball_red">11</a> <a href="javascript:void(0);" class="ball ball_red">12</a> <a href="javascript:void(0);" class="ball ball_red">13</a> <a href="javascript:void(0);" class="ball ball_red">14</a> <a href="javascript:void(0);" class="ball ball_red">15</a> <a href="javascript:void(0);" class="ball ball_red">16</a> <a href="javascript:void(0);" class="ball ball_red">17</a> <a href="javascript:void(0);" class="ball ball_red">18</a> <a href="javascript:void(0);" class="ball ball_red">19</a> <a href="javascript:void(0);" class="ball ball_red">20</a> <a href="javascript:void(0);" class="ball ball_red">21</a> <a href="javascript:void(0);" class="ball ball_red">22</a> <a href="javascript:void(0);" class="ball ball_red">23</a> <a href="javascript:void(0);" class="ball ball_red">24</a> <a href="javascript:void(0);" class="ball ball_red">25</a> <a href="javascript:void(0);" class="ball ball_red">26</a> <a href="javascript:void(0);" class="ball ball_red">27</a> <a href="javascript:void(0);" class="ball ball_red">28</a> <a href="javascript:void(0);" class="ball ball_red">29</a> <a href="javascript:void(0);" class="ball ball_red">30</a> <a href="javascript:void(0);" class="ball ball_red">31</a> <a href="javascript:void(0);" class="ball ball_red">32</a> <a href="javascript:void(0);" class="ball ball_red">33</a> </div> <div class="ball_row"> <a href="javascript:void(0);" class="ball ball_blue">01</a> <a href="javascript:void(0);" class="ball ball_blue">02</a> <a href="javascript:void(0);" class="ball ball_blue">03</a> <a href="javascript:void(0);" class="ball ball_blue">04</a> <a href="javascript:void(0);" class="ball ball_blue">05</a> <a href="javascript:void(0);" class="ball ball_blue">06</a> <a href="javascript:void(0);" class="ball ball_blue">07</a> <a href="javascript:void(0);" class="ball ball_blue">08</a> <a href="javascript:void(0);" class="ball ball_blue">09</a> <a href="javascript:void(0);" class="ball ball_blue">10</a> <a href="javascript:void(0);" class="ball ball_blue">11</a> <a href="javascript:void(0);" class="ball ball_blue">12</a> <a href="javascript:void(0);" class="ball ball_blue">13</a> <a href="javascript:void(0);" class="ball ball_blue">14</a> <a href="javascript:void(0);" class="ball ball_blue">15</a> <a href="javascript:void(0);" class="ball ball_blue">16</a> </div> </div> <div class="footer"> <div class="content"> <div> <p class="text-center" style="margin-bottom: 10px;">已选择 <span id="stakeNum" class="text-red" style="font-weight: bold;">0</span> 注</p> </div> <div class="col-xs-3"> <a href="javascript:;" id="random" class="weui_btn weui_btn_default text-red">随机一注</a> </div> <div class="col-xs-9 pull-right"> <a href="javascript:;" id="submitDoubleBallSelect" class="weui_btn weui_btn_warn">下一步</a> </div> <div style="clear:both;height:0px;"></div> </div> </div>',new d(i)})}();var Cookie={get:function(a){var e,t=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(e=document.cookie.match(t))?unescape(e[2]):null},set:function(a,e){document.cookie=a+"="+e},getFromJson:function(a){var e,t=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(e=document.cookie.match(t))?JSON.parse(unescape(e[2])):null},setToJson:function(a,e){document.cookie=a+"="+JSON.stringify(e)}},getCombineNum=function(a,e){if(a<=0||e<=0||a<e)return 0;var t=e;if(a<2*e&&(t=a-e),0==t)return 1;for(var l=1,i=0;i<t;i++)l*=a-i;for(var s=1,n=t;n>=1;n--)s*=n;return l/=s},ballsText=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33"],genRandom=function(a){return parseInt(a*Math.random())},getRandomReds=function(){for(var a=[],e=[].concat(ballsText),t=0;t<6;t++){var l=genRandom(33-t);a[t]=e[l],e.splice(l,1)}return a.sort()},getRandomBlue=function(){return[ballsText[genRandom(16)]]},stringifyBalls=function(a){return a.map(function(a){return a.red.toString()+"+"+a.blue.toString()})},week=["日","一","二","三","四","五","六"],getTimeStr=function(a){var e=new Date(a),t="周"+week[e.getDay()]+" ";t+=e.getHours()+":";var l=e.getMinutes();return l<10&&(l="0"+l),t+=l};!function(a){"use strict";function e(){var e=window.outerWidth;e>=320&&a(".ball_row").css("padding-left",Math.floor((e-320)%51/2))}function t(){function e(){s=a.extend([],i),l.red.length>=6&&l.blue.length>=1&&JSON.stringify(s).indexOf(JSON.stringify(l))<0&&s.push(l);var e=0;a.each(s,function(a,t){e+=getCombineNum(t.red.length,6)*getCombineNum(t.blue.length,1)}),a("#stakeNum").text(e)}function t(e){var t=a(".ball_red"),l=a(".ball_blue");t.removeClass("active"),l.removeClass("active"),t.each(function(t,l){e.red.indexOf(a(l).text())>=0&&a(l).addClass("active")}),l.each(function(t,l){e.blue.indexOf(a(l).text())>=0&&a(l).addClass("active")})}var l={red:[],blue:[]},i=Cookie.getFromJson("balls")||[],s=[];e(),a("#container").off().on("tap",".ball_red",function(){var t=a(".ball_red.active").length,i=a(this);i.hasClass("active")?(i.removeClass("active"),l.red.splice(l.red.indexOf(i.text()),1)):(i.addClass("active"),l.red[t]=i.text()),e()}).on("tap",".ball_blue",function(){var t=a(".ball_blue.active").length,i=a(this);i.hasClass("active")?(i.removeClass("active"),l.blue.splice(l.blue.indexOf(i.text()),1)):(i.addClass("active"),l.blue[t]=i.text()),e()}).on("tap","#random",function(){l={red:getRandomReds(),blue:getRandomBlue()},t(l),e()}).on("tap","#submitDoubleBallSelect",function(){s.length>0&&a("#stakeNum").text()>0&&(Cookie.setToJson("balls",s),window.location.hash="#/buy")})}function l(){function e(){a("#ball_list").html(template("ssqBuyList",{list:r})),o=0,a.each(r,function(a,e){o+=getCombineNum(e.red.length,6)*getCombineNum(e.blue.length,1)*2}),t()}function t(){a("#totalFee").text(o*l.val()*n.val())}var l=a("#period"),n=a("#multiple"),r=Cookie.getFromJson("balls")||[],o=0;e(),a("#container").off().on("tap","#randomFive",function(){for(var a=0;a<5;){var t={red:getRandomReds(),blue:getRandomBlue()};r.indexOf(t)<0&&(r.push(t),a++)}Cookie.setToJson("balls",r),e()}).on("tap","#selectBall",function(){history.go(-1)}).on("input",["#period","#multiple"],t).on("tap","#periodMinus",function(){var e=l.val();e>1&&(a("#period").val(--e),t())}).on("tap","#periodAdd",function(){var e=l.val();a("#period").val(++e),t()}).on("tap","#multipleMinus",function(){var e=n.val();e>1&&(a("#multiple").val(--e),t())}).on("tap","#multipleAdd",function(){var e=n.val();a("#multiple").val(++e),t()}).on("change","#confirmProto",function(){var e=a("#submitDoubleBallSelect");a(this).attr("checked")?e.removeClass("weui_btn_disabled"):e.addClass("weui_btn_disabled")}).on("tap",".ball_list_item",function(){var t=a(this);t.hide(),r.splice(t.attr("data-index"),1),Cookie.setToJson("balls",r),e()}).on("tap","#submitDoubleBallSelect",function(){a("#submitDoubleBallSelect").hasClass("weui_btn_disabled")||a.ajax({type:"POST",url:"/api/lottery/ssq/create?tradeType=JSAPI&body=test",contentType:"application/json",dataType:"json",data:JSON.stringify({numbers:stringifyBalls(r),periods:l.val(),times:n.val()}),success:function(a){alert(JSON.stringify(a));var e=a.data;s(i(e))},error:function(a){alert(JSON.stringify(a))}})})}function i(a){return function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp,nonceStr:a.nonceStr,"package":a["package"],signType:a.signType,paySign:a.paySign},function(a){"get_brand_wcpay_request:ok"==a.err_msg&&alert("支付成功")})}}function s(a){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",a,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",a),document.attachEvent("onWeixinJSBridgeReady",a)):a()}var n=new Router({container:"#container"}),r='<p style="margin-top: 50%;text-align: center;">Sorry! 服务器繁忙,请稍后再试</p>',o={url:"/select",className:"ssq-select",render:function(){return new Promise(function(t,l){a.getJSON("/api/lottery/period/current?lotteryType=ssq",function(a){"SUCCESS"==a.stateCode?(t(template("ssqSelect",{lottery:a.data})),e()):t(r)},function(){t(r)})})},bind:t},c={url:"/buy",className:"ssq-buy",render:function(){var a=Cookie.getFromJson("balls")||[];return new Promise(function(e,t){e(template("ssqBuy",{list:a}))})},bind:l};n.push(o).push(c).setDefault("/select").init(),Cookie.set("openid","olz_hvsELAlrfI_0715gnh8un04Q"),a.getJSON("/api/user/current?code="+GetQueryString("code")+"&openid="+Cookie.get("openid"),function(e){if("SUCCESS"==e.stateCode){var t=e.data;Cookie.set("openid",t.openid)}else a("#container").html(r)},function(e){a("#container").html(r)}),/Android/gi.test(navigator.userAgent)&&window.addEventListener("resize",function(){"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName||window.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0)})}(Zepto);